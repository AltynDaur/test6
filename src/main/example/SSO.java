package main.example;


import com.sun.deploy.net.HttpResponse;
import hudson.Extension;
import hudson.Util;
import hudson.model.Descriptor;
import hudson.model.User;
import org.opensaml.common.IdentifierGenerator;
import org.opensaml.common.binding.BasicSAMLMessageContext;
import org.opensaml.common.impl.SecureRandomIdentifierGenerator;
import org.opensaml.ws.message.encoder.MessageEncoder;
import org.kohsuke.stapler.*;
import com.google.common.base.Preconditions;
import org.kohsuke.stapler.Header;
import org.kohsuke.stapler.HttpResponses;
import org.opensaml.ws.message.encoder.MessageEncoder;
import org.opensaml.ws.transport.http.HttpServletRequestAdapter;
import org.opensaml.xml.security.credential.Credential;
import org.pac4j.cas.client.CasClient;
import org.pac4j.cas.credentials.CasCredentials;
import org.pac4j.core.client.RedirectAction;
import org.pac4j.core.client.RedirectAction.RedirectType;
import org.pac4j.core.context.J2EContext;
import org.pac4j.core.context.J2ERequestContext;
import org.pac4j.core.context.WebContext;
import org.pac4j.core.exception.RequiresHttpAction;
import org.pac4j.saml.client.Saml2Client;
import org.pac4j.saml.credentials.Saml2Credentials;
import org.pac4j.saml.profile.Saml2Profile;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import java.io.*;
import java.security.NoSuchAlgorithmException;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 * Created by Sergey_Stefoglo1 on 9/2/2015.
 */
public class SSO {
    //String idpMetadata=new String("<EntityDescriptor ID=\"_05ed2c52-ca97-46c3-9755-76d8c167e523\" entityID=\"https://login-prod.epm-sso.projects.epam.com/adfs/services/trust\" xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\"><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><ds:Reference URI=\"#_05ed2c52-ca97-46c3-9755-76d8c167e523\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>iM7+fHS0hJ4+ZBCzBLW1HXpcBTo3nvppZeozfTuMJVc=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>oirD5YopKUHbTCQLE5h6zEc5TS70PA/ebCwgMo3IOmwdGf6y75OwsMggXyGPWSbkHkMwEfviGZQ2DB4uXi1TrJligk4kAE9ip8L2N1BVChD9nmRZnLoSm5zAMZMKYQjVtUDGp2DHyw21K6sDKtzwyl67cqQygYIee8gqa+3MsnATjt+vvY6O395ODd2NMdI7aPe/bMwFyLdNNvPLrxhV5nF51gyz0gqbZ4a9DeeZcr+OceIfi5Mboq20wIJ8elVoFHtVU2zlvibwoMr+Ap2oQWTF+mio6vtcgwsACqa4bi2hQ0EqkdsZVB5FV0QgCX5/m2Lj62phSWwOpiO7KHXd7A==</ds:SignatureValue><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDBDCCAeygAwIBAgIQOHCt2VCSGadAADtrAeNAWTANBgkqhkiG9w0BAQsFADA+MTwwOgYDVQQDEzNBREZTIFNpZ25pbmcgLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wHhcNMTQxMjI4MjAwNzI2WhcNMTUxMjI4MjAwNzI2WjA+MTwwOgYDVQQDEzNBREZTIFNpZ25pbmcgLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCjAoz9gwjIPFcWYFHh5VNqLDhRLN7fW5Y/ZPBfwIrt3hnonQj59PUYHgwGulC5znXM2xekzA6SN6CRfKqnlwiaFromW9JTSzRlfQgGgsiBACEdsKf1fyKgpxeN4spEj/jDhC5pI0cM8Szm6VqMAHcDYCyJbJ+QhhFFy1HM+uy3pQOlXljpRFaHFZRuKyJirYeLM9MxZZ8y/Z/tRrNdB9k5CQz/jcuU+OVxE82H77OpvzDpaSgDZFuoVMCwq759Yl+SuWxd4qtEKgu11WM0VpJwxCP/f/nBNV93ManYxn3ODRDCabYH5eG3d2l7u2IqO6VGQVOpU1xk4uNol/Zkpje1AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJhCntLNY+Z7x+96GqB0RwoCowy3WhAYqZSicyLnqMdFWSHurlqkHbw8Eu+iiAwnWonYadSnGndPhAeoPOsm+l6gS+uKbvElS7XmU4DRmWAVzmra+Yl5wccD7ZxFcTDkg/1qx74E4Is4mWRpHpWz45VjLnGpG4rpgkolXOtz25oEWCgE2ixqtF9ktTHiEy7o91VU/RGE3fHsAj1jHPFVbgYeyPp4Zg14Dqh/bsc7kSt6XZkE3PCfvY8/w5U3nrkWINqHA0GFyyvWjfgOtMOQd9Shib4g5/JbnjQDOlgmiQpdlB8w7hD1Wh7T8yuZqDnTJR8GysgouIn97kMhRh7Rj40=</X509Certificate></X509Data></KeyInfo></ds:Signature><RoleDescriptor xsi:type=\"fed:ApplicationServiceType\" protocolSupportEnumeration=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512 http://schemas.xmlsoap.org/ws/2005/02/trust http://docs.oasis-open.org/wsfed/federation/200706\" ServiceDisplayName=\"EPAM.COM\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:fed=\"http://docs.oasis-open.org/wsfed/federation/200706\"><KeyDescriptor use=\"encryption\"><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDCjCCAfKgAwIBAgIQcWxCoFBJV7RBWtsC9aiYxzANBgkqhkiG9w0BAQsFADBBMT8wPQYDVQQDEzZBREZTIEVuY3J5cHRpb24gLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wHhcNMTQxMjI4MjAwNzI0WhcNMTUxMjI4MjAwNzI0WjBBMT8wPQYDVQQDEzZBREZTIEVuY3J5cHRpb24gLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC2TDth2cYwrHGOCsAe2Yuv7cfA9HPf14cN91Z6CCSz7P1ZTPKaOHU2UTdp5b610SY8XJVSReaXN9BCW26qkofSmWbeFTPAhlEGXApeufzhBLw8crEZNu/41PY9sA+uH9m1F3cty1Ld6j79T4oH9gpjhm4LiPppJE4DWAGGUk2Edo3r0hAKa/w1bZTr4b05oqiv+9e4Wa61a4q237hhGNr+FOfCcSSHhEAvNpOiifmflaiOdRLbbpsbDzKwt67LkTz9aEG3UO5Es7vQA25/ZFLDns8N3CgJt0r+xXgJZctva7E+FL+brg9B3u14g0ZFczxf6/H7+kpJuMGTo9TPTX7VAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAIqaKefL3bEng5/77sVHs9T0NSKqk0ahousW3jxu2yl/2PkwLfULrPPu27bCFMTjvu/9suAAWq2z+KpEyi2dfnDz3YFVvLRhVmHOxh5YDhEskrb8EyP/5+GaydZEPujfyGA0GQDsQYt/AkPiyeTwgecj7on84YbISnEsm/Uc1soS2ITpaCQvRIuXeHCf8WZLjkONTatIWxjP1HqQhbaK96+7F2WsJL+86PGYDJB1MGwF1+cOkxdW1UqM/rCkv/5tG7EOEDAMPoL+dS9tFeHvPv0j855fpXcJ1M05GZIeSKHUKKAYZuyja5bV41JBTMLNaPq3zygeYy7JemflBA/J9JQ=</X509Certificate></X509Data></KeyInfo></KeyDescriptor><fed:ClaimTypesRequested><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>E-Mail Address</auth:DisplayName><auth:Description>The e-mail address of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Given Name</auth:DisplayName><auth:Description>The given name of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Name</auth:DisplayName><auth:Description>The unique name of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>UPN</auth:DisplayName><auth:Description>The user principal name (UPN) of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/claims/CommonName\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Common Name</auth:DisplayName><auth:Description>The common name of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/claims/EmailAddress\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>AD FS 1.x E-Mail Address</auth:DisplayName><auth:Description>The e-mail address of the user when interoperating with AD FS 1.1 or AD FS 1.0</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/claims/Group\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Group</auth:DisplayName><auth:Description>A group that the user is a member of</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/claims/UPN\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>AD FS 1.x UPN</auth:DisplayName><auth:Description>The UPN of the user when interoperating with AD FS 1.1 or AD FS 1.0</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/role\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Role</auth:DisplayName><auth:Description>A role that the user has</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Surname</auth:DisplayName><auth:Description>The surname of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/privatepersonalidentifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>PPID</auth:DisplayName><auth:Description>The private identifier of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Name ID</auth:DisplayName><auth:Description>The SAML name identifier of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationinstant\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Authentication time stamp</auth:DisplayName><auth:Description>Used to display the time and date that the user was authenticated</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationmethod\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Authentication method</auth:DisplayName><auth:Description>The method used to authenticate the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/denyonlysid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Deny only group SID</auth:DisplayName><auth:Description>The deny-only group SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/denyonlyprimarysid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Deny only primary SID</auth:DisplayName><auth:Description>The deny-only primary SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/denyonlyprimarygroupsid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Deny only primary group SID</auth:DisplayName><auth:Description>The deny-only primary group SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Group SID</auth:DisplayName><auth:Description>The group SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/primarygroupsid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Primary group SID</auth:DisplayName><auth:Description>The primary group SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Primary SID</auth:DisplayName><auth:Description>The primary SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Windows account name</auth:DisplayName><auth:Description>The domain account name of the user in the form of domain\\user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/isregistereduser\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Is Registered User</auth:DisplayName><auth:Description>User is registered to use this device</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/identifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device Identifier</auth:DisplayName><auth:Description>Identifier of the device</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/registrationid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device Registration Identifier</auth:DisplayName><auth:Description>Identifier for Device Registration</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/displayname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device Registration DisplayName</auth:DisplayName><auth:Description>Display name of Device Registration</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/ostype\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device OS type</auth:DisplayName><auth:Description>OS type of the device</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/osversion\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device OS Version</auth:DisplayName><auth:Description>OS version of the device</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/ismanaged\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Is Managed Device</auth:DisplayName><auth:Description>Device is managed by a management service</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-forwarded-client-ip\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Forwarded Client IP</auth:DisplayName><auth:Description>IP address of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-client-application\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Client Application</auth:DisplayName><auth:Description>Type of the Client Application</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-client-user-agent\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Client User Agent</auth:DisplayName><auth:Description>Device type the client is using to access the application</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-client-ip\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Client IP</auth:DisplayName><auth:Description>IP address of the client</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-endpoint-absolute-path\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Endpoint Path</auth:DisplayName><auth:Description>Absolute Endpoint path which can be used to determine active versus passive clients</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-proxy\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Proxy</auth:DisplayName><auth:Description>DNS name of the federation server proxy that passed the request</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/relyingpartytrustid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Application Identifier</auth:DisplayName><auth:Description>Identifier for the Relying Party</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/applicationpolicy\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Application policies</auth:DisplayName><auth:Description>Application policies of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/authoritykeyidentifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Authority Key Identifier</auth:DisplayName><auth:Description>The Authority Key Identifier extension of the certificate that signed an issued certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/basicconstraints\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Basic Constraint</auth:DisplayName><auth:Description>One of the basic constraints of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/eku\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Enhanced Key Usage</auth:DisplayName><auth:Description>Describes one of the enhanced key usages of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/issuer\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Issuer</auth:DisplayName><auth:Description>The name of the certificate authority that issued the X.509 certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/issuername\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Issuer Name</auth:DisplayName><auth:Description>The distinguished name of the certificate issuer</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/keyusage\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Key Usage</auth:DisplayName><auth:Description>One of the key usages of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/notafter\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Not After</auth:DisplayName><auth:Description>Date in local time after which a certificate is no longer valid</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/notbefore\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Not Before</auth:DisplayName><auth:Description>The date in local time on which a certificate becomes valid</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/certificatepolicy\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Certificate Policies</auth:DisplayName><auth:Description>The policies under which the certificate has been issued</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/rsa\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Public Key</auth:DisplayName><auth:Description>Public Key of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/rawdata\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Certificate Raw Data</auth:DisplayName><auth:Description>The raw data of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/san\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Subject Alternative Name</auth:DisplayName><auth:Description>One of the alternative names of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/serialnumber\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Serial Number</auth:DisplayName><auth:Description>The serial number of a certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/signaturealgorithm\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Signature Algorithm</auth:DisplayName><auth:Description>The algorithm used to create the signature of a certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/subject\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Subject</auth:DisplayName><auth:Description>The subject from the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/subjectkeyidentifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Subject Key Identifier</auth:DisplayName><auth:Description>Describes the subject key identifier of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/subjectname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Subject Name</auth:DisplayName><auth:Description>The subject distinguished name from a certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/certificatetemplateinformation\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>V2 Template Name</auth:DisplayName><auth:Description>The name of the version 2 certificate template used when issuing or renewing a certificate. The extension is Microsoft specific.</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/certificatetemplatename\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>V1 Template Name</auth:DisplayName><auth:Description>The name of the version 1 certificate template used when issuing or renewing a certificate. The extension is Microsoft specific.</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/thumbprint\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Thumbprint</auth:DisplayName><auth:Description>Thumbprint of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/x509version\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>X.509 Version</auth:DisplayName><auth:Description>The X.509 format version of a certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2012/01/insidecorporatenetwork\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Inside Corporate Network</auth:DisplayName><auth:Description>Used to indicate if a request originated inside corporate network</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2012/01/passwordexpirationtime\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Password Expiration Time</auth:DisplayName><auth:Description>Used to display the time when the password expires</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2012/01/passwordexpirationdays\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Password Expiration Days</auth:DisplayName><auth:Description>Used to display the number of days to password expiry</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2012/01/passwordchangeurl\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Update Password URL</auth:DisplayName><auth:Description>Used to display the web address of update password service</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/claims/authnmethodsreferences\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Authentication Methods References</auth:DisplayName><auth:Description>Used to indicate all authentication methods used to authenticate the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/client-request-id\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Client Request ID</auth:DisplayName><auth:Description>Identifier for a user session</auth:Description></auth:ClaimType></fed:ClaimTypesRequested><fed:TargetScopes><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/services/trust/2005/issuedtokenmixedasymmetricbasic256</Address></EndpointReference><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/services/trust/2005/issuedtokenmixedsymmetricbasic256</Address></EndpointReference><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/services/trust/13/issuedtokenmixedasymmetricbasic256</Address></EndpointReference><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/services/trust/13/issuedtokenmixedsymmetricbasic256</Address></EndpointReference><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/ls/</Address></EndpointReference><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/services/trust</Address></EndpointReference></fed:TargetScopes><fed:ApplicationServiceEndpoint><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/services/trust/2005/issuedtokenmixedasymmetricbasic256</Address></EndpointReference></fed:ApplicationServiceEndpoint><fed:PassiveRequestorEndpoint><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/ls/</Address></EndpointReference></fed:PassiveRequestorEndpoint></RoleDescriptor><RoleDescriptor xsi:type=\"fed:SecurityTokenServiceType\" protocolSupportEnumeration=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512 http://schemas.xmlsoap.org/ws/2005/02/trust http://docs.oasis-open.org/wsfed/federation/200706\" ServiceDisplayName=\"EPAM.COM\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:fed=\"http://docs.oasis-open.org/wsfed/federation/200706\"><KeyDescriptor use=\"signing\"><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDBDCCAeygAwIBAgIQOHCt2VCSGadAADtrAeNAWTANBgkqhkiG9w0BAQsFADA+MTwwOgYDVQQDEzNBREZTIFNpZ25pbmcgLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wHhcNMTQxMjI4MjAwNzI2WhcNMTUxMjI4MjAwNzI2WjA+MTwwOgYDVQQDEzNBREZTIFNpZ25pbmcgLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCjAoz9gwjIPFcWYFHh5VNqLDhRLN7fW5Y/ZPBfwIrt3hnonQj59PUYHgwGulC5znXM2xekzA6SN6CRfKqnlwiaFromW9JTSzRlfQgGgsiBACEdsKf1fyKgpxeN4spEj/jDhC5pI0cM8Szm6VqMAHcDYCyJbJ+QhhFFy1HM+uy3pQOlXljpRFaHFZRuKyJirYeLM9MxZZ8y/Z/tRrNdB9k5CQz/jcuU+OVxE82H77OpvzDpaSgDZFuoVMCwq759Yl+SuWxd4qtEKgu11WM0VpJwxCP/f/nBNV93ManYxn3ODRDCabYH5eG3d2l7u2IqO6VGQVOpU1xk4uNol/Zkpje1AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJhCntLNY+Z7x+96GqB0RwoCowy3WhAYqZSicyLnqMdFWSHurlqkHbw8Eu+iiAwnWonYadSnGndPhAeoPOsm+l6gS+uKbvElS7XmU4DRmWAVzmra+Yl5wccD7ZxFcTDkg/1qx74E4Is4mWRpHpWz45VjLnGpG4rpgkolXOtz25oEWCgE2ixqtF9ktTHiEy7o91VU/RGE3fHsAj1jHPFVbgYeyPp4Zg14Dqh/bsc7kSt6XZkE3PCfvY8/w5U3nrkWINqHA0GFyyvWjfgOtMOQd9Shib4g5/JbnjQDOlgmiQpdlB8w7hD1Wh7T8yuZqDnTJR8GysgouIn97kMhRh7Rj40=</X509Certificate></X509Data></KeyInfo></KeyDescriptor><fed:TokenTypesOffered><fed:TokenType Uri=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><fed:TokenType Uri=\"urn:oasis:names:tc:SAML:1.0:assertion\"/></fed:TokenTypesOffered><fed:ClaimTypesOffered><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>E-Mail Address</auth:DisplayName><auth:Description>The e-mail address of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Given Name</auth:DisplayName><auth:Description>The given name of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Name</auth:DisplayName><auth:Description>The unique name of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>UPN</auth:DisplayName><auth:Description>The user principal name (UPN) of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/claims/CommonName\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Common Name</auth:DisplayName><auth:Description>The common name of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/claims/EmailAddress\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>AD FS 1.x E-Mail Address</auth:DisplayName><auth:Description>The e-mail address of the user when interoperating with AD FS 1.1 or AD FS 1.0</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/claims/Group\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Group</auth:DisplayName><auth:Description>A group that the user is a member of</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/claims/UPN\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>AD FS 1.x UPN</auth:DisplayName><auth:Description>The UPN of the user when interoperating with AD FS 1.1 or AD FS 1.0</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/role\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Role</auth:DisplayName><auth:Description>A role that the user has</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Surname</auth:DisplayName><auth:Description>The surname of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/privatepersonalidentifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>PPID</auth:DisplayName><auth:Description>The private identifier of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Name ID</auth:DisplayName><auth:Description>The SAML name identifier of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationinstant\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Authentication time stamp</auth:DisplayName><auth:Description>Used to display the time and date that the user was authenticated</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationmethod\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Authentication method</auth:DisplayName><auth:Description>The method used to authenticate the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/denyonlysid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Deny only group SID</auth:DisplayName><auth:Description>The deny-only group SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/denyonlyprimarysid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Deny only primary SID</auth:DisplayName><auth:Description>The deny-only primary SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/denyonlyprimarygroupsid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Deny only primary group SID</auth:DisplayName><auth:Description>The deny-only primary group SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Group SID</auth:DisplayName><auth:Description>The group SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/primarygroupsid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Primary group SID</auth:DisplayName><auth:Description>The primary group SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Primary SID</auth:DisplayName><auth:Description>The primary SID of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Windows account name</auth:DisplayName><auth:Description>The domain account name of the user in the form of domain\\user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/isregistereduser\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Is Registered User</auth:DisplayName><auth:Description>User is registered to use this device</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/identifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device Identifier</auth:DisplayName><auth:Description>Identifier of the device</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/registrationid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device Registration Identifier</auth:DisplayName><auth:Description>Identifier for Device Registration</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/displayname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device Registration DisplayName</auth:DisplayName><auth:Description>Display name of Device Registration</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/ostype\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device OS type</auth:DisplayName><auth:Description>OS type of the device</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/osversion\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Device OS Version</auth:DisplayName><auth:Description>OS version of the device</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/ismanaged\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Is Managed Device</auth:DisplayName><auth:Description>Device is managed by a management service</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-forwarded-client-ip\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Forwarded Client IP</auth:DisplayName><auth:Description>IP address of the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-client-application\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Client Application</auth:DisplayName><auth:Description>Type of the Client Application</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-client-user-agent\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Client User Agent</auth:DisplayName><auth:Description>Device type the client is using to access the application</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-client-ip\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Client IP</auth:DisplayName><auth:Description>IP address of the client</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-endpoint-absolute-path\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Endpoint Path</auth:DisplayName><auth:Description>Absolute Endpoint path which can be used to determine active versus passive clients</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-proxy\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Proxy</auth:DisplayName><auth:Description>DNS name of the federation server proxy that passed the request</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/relyingpartytrustid\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Application Identifier</auth:DisplayName><auth:Description>Identifier for the Relying Party</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/applicationpolicy\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Application policies</auth:DisplayName><auth:Description>Application policies of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/authoritykeyidentifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Authority Key Identifier</auth:DisplayName><auth:Description>The Authority Key Identifier extension of the certificate that signed an issued certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/basicconstraints\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Basic Constraint</auth:DisplayName><auth:Description>One of the basic constraints of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/eku\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Enhanced Key Usage</auth:DisplayName><auth:Description>Describes one of the enhanced key usages of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/issuer\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Issuer</auth:DisplayName><auth:Description>The name of the certificate authority that issued the X.509 certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/issuername\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Issuer Name</auth:DisplayName><auth:Description>The distinguished name of the certificate issuer</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/keyusage\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Key Usage</auth:DisplayName><auth:Description>One of the key usages of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/notafter\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Not After</auth:DisplayName><auth:Description>Date in local time after which a certificate is no longer valid</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/notbefore\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Not Before</auth:DisplayName><auth:Description>The date in local time on which a certificate becomes valid</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/certificatepolicy\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Certificate Policies</auth:DisplayName><auth:Description>The policies under which the certificate has been issued</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/rsa\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Public Key</auth:DisplayName><auth:Description>Public Key of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/rawdata\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Certificate Raw Data</auth:DisplayName><auth:Description>The raw data of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/san\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Subject Alternative Name</auth:DisplayName><auth:Description>One of the alternative names of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/serialnumber\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Serial Number</auth:DisplayName><auth:Description>The serial number of a certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/signaturealgorithm\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Signature Algorithm</auth:DisplayName><auth:Description>The algorithm used to create the signature of a certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/subject\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Subject</auth:DisplayName><auth:Description>The subject from the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/subjectkeyidentifier\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Subject Key Identifier</auth:DisplayName><auth:Description>Describes the subject key identifier of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/subjectname\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Subject Name</auth:DisplayName><auth:Description>The subject distinguished name from a certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/certificatetemplateinformation\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>V2 Template Name</auth:DisplayName><auth:Description>The name of the version 2 certificate template used when issuing or renewing a certificate. The extension is Microsoft specific.</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/certificatetemplatename\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>V1 Template Name</auth:DisplayName><auth:Description>The name of the version 1 certificate template used when issuing or renewing a certificate. The extension is Microsoft specific.</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/thumbprint\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Thumbprint</auth:DisplayName><auth:Description>Thumbprint of the certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/x509version\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>X.509 Version</auth:DisplayName><auth:Description>The X.509 format version of a certificate</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2012/01/insidecorporatenetwork\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Inside Corporate Network</auth:DisplayName><auth:Description>Used to indicate if a request originated inside corporate network</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2012/01/passwordexpirationtime\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Password Expiration Time</auth:DisplayName><auth:Description>Used to display the time when the password expires</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2012/01/passwordexpirationdays\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Password Expiration Days</auth:DisplayName><auth:Description>Used to display the number of days to password expiry</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/ws/2012/01/passwordchangeurl\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Update Password URL</auth:DisplayName><auth:Description>Used to display the web address of update password service</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/claims/authnmethodsreferences\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Authentication Methods References</auth:DisplayName><auth:Description>Used to indicate all authentication methods used to authenticate the user</auth:Description></auth:ClaimType><auth:ClaimType Uri=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/client-request-id\" Optional=\"true\" xmlns:auth=\"http://docs.oasis-open.org/wsfed/authorization/200706\"><auth:DisplayName>Client Request ID</auth:DisplayName><auth:Description>Identifier for a user session</auth:Description></auth:ClaimType></fed:ClaimTypesOffered><fed:SecurityTokenServiceEndpoint><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/services/trust/2005/certificatemixed</Address><Metadata><Metadata xmlns=\"http://schemas.xmlsoap.org/ws/2004/09/mex\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:wsx=\"http://schemas.xmlsoap.org/ws/2004/09/mex\"><wsx:MetadataSection Dialect=\"http://schemas.xmlsoap.org/ws/2004/09/mex\" xmlns=\"\"><wsx:MetadataReference><Address xmlns=\"http://www.w3.org/2005/08/addressing\">https://login-prod.epm-sso.projects.epam.com/adfs/services/trust/mex</Address></wsx:MetadataReference></wsx:MetadataSection></Metadata></Metadata></EndpointReference></fed:SecurityTokenServiceEndpoint><fed:PassiveRequestorEndpoint><EndpointReference xmlns=\"http://www.w3.org/2005/08/addressing\"><Address>https://login-prod.epm-sso.projects.epam.com/adfs/ls/</Address></EndpointReference></fed:PassiveRequestorEndpoint></RoleDescriptor><SPSSODescriptor WantAssertionsSigned=\"true\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\"><KeyDescriptor use=\"encryption\"><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDCjCCAfKgAwIBAgIQcWxCoFBJV7RBWtsC9aiYxzANBgkqhkiG9w0BAQsFADBBMT8wPQYDVQQDEzZBREZTIEVuY3J5cHRpb24gLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wHhcNMTQxMjI4MjAwNzI0WhcNMTUxMjI4MjAwNzI0WjBBMT8wPQYDVQQDEzZBREZTIEVuY3J5cHRpb24gLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC2TDth2cYwrHGOCsAe2Yuv7cfA9HPf14cN91Z6CCSz7P1ZTPKaOHU2UTdp5b610SY8XJVSReaXN9BCW26qkofSmWbeFTPAhlEGXApeufzhBLw8crEZNu/41PY9sA+uH9m1F3cty1Ld6j79T4oH9gpjhm4LiPppJE4DWAGGUk2Edo3r0hAKa/w1bZTr4b05oqiv+9e4Wa61a4q237hhGNr+FOfCcSSHhEAvNpOiifmflaiOdRLbbpsbDzKwt67LkTz9aEG3UO5Es7vQA25/ZFLDns8N3CgJt0r+xXgJZctva7E+FL+brg9B3u14g0ZFczxf6/H7+kpJuMGTo9TPTX7VAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAIqaKefL3bEng5/77sVHs9T0NSKqk0ahousW3jxu2yl/2PkwLfULrPPu27bCFMTjvu/9suAAWq2z+KpEyi2dfnDz3YFVvLRhVmHOxh5YDhEskrb8EyP/5+GaydZEPujfyGA0GQDsQYt/AkPiyeTwgecj7on84YbISnEsm/Uc1soS2ITpaCQvRIuXeHCf8WZLjkONTatIWxjP1HqQhbaK96+7F2WsJL+86PGYDJB1MGwF1+cOkxdW1UqM/rCkv/5tG7EOEDAMPoL+dS9tFeHvPv0j855fpXcJ1M05GZIeSKHUKKAYZuyja5bV41JBTMLNaPq3zygeYy7JemflBA/J9JQ=</X509Certificate></X509Data></KeyInfo></KeyDescriptor><KeyDescriptor use=\"signing\"><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDBDCCAeygAwIBAgIQOHCt2VCSGadAADtrAeNAWTANBgkqhkiG9w0BAQsFADA+MTwwOgYDVQQDEzNBREZTIFNpZ25pbmcgLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wHhcNMTQxMjI4MjAwNzI2WhcNMTUxMjI4MjAwNzI2WjA+MTwwOgYDVQQDEzNBREZTIFNpZ25pbmcgLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCjAoz9gwjIPFcWYFHh5VNqLDhRLN7fW5Y/ZPBfwIrt3hnonQj59PUYHgwGulC5znXM2xekzA6SN6CRfKqnlwiaFromW9JTSzRlfQgGgsiBACEdsKf1fyKgpxeN4spEj/jDhC5pI0cM8Szm6VqMAHcDYCyJbJ+QhhFFy1HM+uy3pQOlXljpRFaHFZRuKyJirYeLM9MxZZ8y/Z/tRrNdB9k5CQz/jcuU+OVxE82H77OpvzDpaSgDZFuoVMCwq759Yl+SuWxd4qtEKgu11WM0VpJwxCP/f/nBNV93ManYxn3ODRDCabYH5eG3d2l7u2IqO6VGQVOpU1xk4uNol/Zkpje1AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJhCntLNY+Z7x+96GqB0RwoCowy3WhAYqZSicyLnqMdFWSHurlqkHbw8Eu+iiAwnWonYadSnGndPhAeoPOsm+l6gS+uKbvElS7XmU4DRmWAVzmra+Yl5wccD7ZxFcTDkg/1qx74E4Is4mWRpHpWz45VjLnGpG4rpgkolXOtz25oEWCgE2ixqtF9ktTHiEy7o91VU/RGE3fHsAj1jHPFVbgYeyPp4Zg14Dqh/bsc7kSt6XZkE3PCfvY8/w5U3nrkWINqHA0GFyyvWjfgOtMOQd9Shib4g5/JbnjQDOlgmiQpdlB8w7hD1Wh7T8yuZqDnTJR8GysgouIn97kMhRh7Rj40=</X509Certificate></X509Data></KeyInfo></KeyDescriptor><SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"https://login-prod.epm-sso.projects.epam.com/adfs/ls/\"/><SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://login-prod.epm-sso.projects.epam.com/adfs/ls/\"/><NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress</NameIDFormat><NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</NameIDFormat><NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:transient</NameIDFormat><AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://login-prod.epm-sso.projects.epam.com/adfs/ls/\" index=\"0\" isDefault=\"true\"/><AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"https://login-prod.epm-sso.projects.epam.com/adfs/ls/\" index=\"1\"/><AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"https://login-prod.epm-sso.projects.epam.com/adfs/ls/\" index=\"2\"/></SPSSODescriptor><IDPSSODescriptor protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\"><KeyDescriptor use=\"encryption\"><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDCjCCAfKgAwIBAgIQcWxCoFBJV7RBWtsC9aiYxzANBgkqhkiG9w0BAQsFADBBMT8wPQYDVQQDEzZBREZTIEVuY3J5cHRpb24gLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wHhcNMTQxMjI4MjAwNzI0WhcNMTUxMjI4MjAwNzI0WjBBMT8wPQYDVQQDEzZBREZTIEVuY3J5cHRpb24gLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC2TDth2cYwrHGOCsAe2Yuv7cfA9HPf14cN91Z6CCSz7P1ZTPKaOHU2UTdp5b610SY8XJVSReaXN9BCW26qkofSmWbeFTPAhlEGXApeufzhBLw8crEZNu/41PY9sA+uH9m1F3cty1Ld6j79T4oH9gpjhm4LiPppJE4DWAGGUk2Edo3r0hAKa/w1bZTr4b05oqiv+9e4Wa61a4q237hhGNr+FOfCcSSHhEAvNpOiifmflaiOdRLbbpsbDzKwt67LkTz9aEG3UO5Es7vQA25/ZFLDns8N3CgJt0r+xXgJZctva7E+FL+brg9B3u14g0ZFczxf6/H7+kpJuMGTo9TPTX7VAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAIqaKefL3bEng5/77sVHs9T0NSKqk0ahousW3jxu2yl/2PkwLfULrPPu27bCFMTjvu/9suAAWq2z+KpEyi2dfnDz3YFVvLRhVmHOxh5YDhEskrb8EyP/5+GaydZEPujfyGA0GQDsQYt/AkPiyeTwgecj7on84YbISnEsm/Uc1soS2ITpaCQvRIuXeHCf8WZLjkONTatIWxjP1HqQhbaK96+7F2WsJL+86PGYDJB1MGwF1+cOkxdW1UqM/rCkv/5tG7EOEDAMPoL+dS9tFeHvPv0j855fpXcJ1M05GZIeSKHUKKAYZuyja5bV41JBTMLNaPq3zygeYy7JemflBA/J9JQ=</X509Certificate></X509Data></KeyInfo></KeyDescriptor><KeyDescriptor use=\"signing\"><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDBDCCAeygAwIBAgIQOHCt2VCSGadAADtrAeNAWTANBgkqhkiG9w0BAQsFADA+MTwwOgYDVQQDEzNBREZTIFNpZ25pbmcgLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wHhcNMTQxMjI4MjAwNzI2WhcNMTUxMjI4MjAwNzI2WjA+MTwwOgYDVQQDEzNBREZTIFNpZ25pbmcgLSBsb2dpbi1wcm9kLmVwbS1zc28ucHJvamVjdHMuZXBhbS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCjAoz9gwjIPFcWYFHh5VNqLDhRLN7fW5Y/ZPBfwIrt3hnonQj59PUYHgwGulC5znXM2xekzA6SN6CRfKqnlwiaFromW9JTSzRlfQgGgsiBACEdsKf1fyKgpxeN4spEj/jDhC5pI0cM8Szm6VqMAHcDYCyJbJ+QhhFFy1HM+uy3pQOlXljpRFaHFZRuKyJirYeLM9MxZZ8y/Z/tRrNdB9k5CQz/jcuU+OVxE82H77OpvzDpaSgDZFuoVMCwq759Yl+SuWxd4qtEKgu11WM0VpJwxCP/f/nBNV93ManYxn3ODRDCabYH5eG3d2l7u2IqO6VGQVOpU1xk4uNol/Zkpje1AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJhCntLNY+Z7x+96GqB0RwoCowy3WhAYqZSicyLnqMdFWSHurlqkHbw8Eu+iiAwnWonYadSnGndPhAeoPOsm+l6gS+uKbvElS7XmU4DRmWAVzmra+Yl5wccD7ZxFcTDkg/1qx74E4Is4mWRpHpWz45VjLnGpG4rpgkolXOtz25oEWCgE2ixqtF9ktTHiEy7o91VU/RGE3fHsAj1jHPFVbgYeyPp4Zg14Dqh/bsc7kSt6XZkE3PCfvY8/w5U3nrkWINqHA0GFyyvWjfgOtMOQd9Shib4g5/JbnjQDOlgmiQpdlB8w7hD1Wh7T8yuZqDnTJR8GysgouIn97kMhRh7Rj40=</X509Certificate></X509Data></KeyInfo></KeyDescriptor><SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"https://login-prod.epm-sso.projects.epam.com/adfs/ls/\"/><SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://login-prod.epm-sso.projects.epam.com/adfs/ls/\"/><NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress</NameIDFormat><NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</NameIDFormat><NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:transient</NameIDFormat><SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"https://login-prod.epm-sso.projects.epam.com/adfs/ls/\"/><SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://login-prod.epm-sso.projects.epam.com/adfs/ls/\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"E-Mail Address\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Given Name\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Name\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"UPN\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/claims/CommonName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Common Name\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/claims/EmailAddress\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"AD FS 1.x E-Mail Address\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/claims/Group\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Group\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/claims/UPN\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"AD FS 1.x UPN\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/role\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Role\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Surname\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/privatepersonalidentifier\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"PPID\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Name ID\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationinstant\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Authentication time stamp\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationmethod\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Authentication method\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/denyonlysid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Deny only group SID\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/denyonlyprimarysid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Deny only primary SID\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/denyonlyprimarygroupsid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Deny only primary group SID\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Group SID\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/primarygroupsid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Primary group SID\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Primary SID\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Windows account name\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/isregistereduser\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Is Registered User\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/identifier\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Device Identifier\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/registrationid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Device Registration Identifier\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/displayname\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Device Registration DisplayName\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/ostype\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Device OS type\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/osversion\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Device OS Version\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/devicecontext/claims/ismanaged\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Is Managed Device\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-forwarded-client-ip\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Forwarded Client IP\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-client-application\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Client Application\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-client-user-agent\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Client User Agent\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-client-ip\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Client IP\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-endpoint-absolute-path\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Endpoint Path\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/x-ms-proxy\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Proxy\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/relyingpartytrustid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Application Identifier\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/applicationpolicy\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Application policies\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/authoritykeyidentifier\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Authority Key Identifier\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/basicconstraints\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Basic Constraint\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/eku\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Enhanced Key Usage\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/issuer\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Issuer\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/issuername\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Issuer Name\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/keyusage\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Key Usage\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/notafter\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Not After\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/notbefore\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Not Before\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/certificatepolicy\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Certificate Policies\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/rsa\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Public Key\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/rawdata\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Certificate Raw Data\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/san\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Subject Alternative Name\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2008/06/identity/claims/serialnumber\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Serial Number\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/signaturealgorithm\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Signature Algorithm\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/subject\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Subject\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/subjectkeyidentifier\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Subject Key Identifier\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/subjectname\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Subject Name\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/certificatetemplateinformation\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"V2 Template Name\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/extension/certificatetemplatename\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"V1 Template Name\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/thumbprint\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Thumbprint\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/12/certificatecontext/field/x509version\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"X.509 Version\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2012/01/insidecorporatenetwork\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Inside Corporate Network\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2012/01/passwordexpirationtime\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Password Expiration Time\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2012/01/passwordexpirationdays\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Password Expiration Days\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/ws/2012/01/passwordchangeurl\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Update Password URL\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/claims/authnmethodsreferences\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Authentication Methods References\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/><Attribute Name=\"http://schemas.microsoft.com/2012/01/requestcontext/claims/client-request-id\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\" FriendlyName=\"Client Request ID\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"/></IDPSSODescriptor><ContactPerson contactType=\"support\"/></EntityDescriptor>");
//    private static final Logger LOG = Logger.getLogger(SamlSecurityRealm.class.getName());
    private static final String REFERER_ATTRIBUTE = SSO.class.getName() + ".referer";
    private static final String CONSUMER_SERVICE_URL_PATH = "securityRealm/finishLogin";
    private static final String DEFAULT_DISPLAY_NAME_ATTRIBUTE_NAME = "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name";
    private static final String DEFAULT_GROUPS_ATTRIBUTE_NAME = "http://schemas.xmlsoap.org/claims/Group";
    private static final int DEFAULT_MAXIMUM_AUTHENTICATION_LIFETIME = 24 * 60 * 60; // 24h

    public void doCommenceLogin(HttpServletRequest request, HttpServletResponse response, Saml2Profile saml2Profile) {
        //  LOG.fine("SamlSecurityRealm.doCommenceLogin called. Using consumerServiceUrl " + getConsumerServiceUrl());
        //       request.getSession().setAttribute(REFERER_ATTRIBUTE, referer);


        try {
            Saml2Client client = newClient();
            WebContext context = new J2EContext(request, response);

            RedirectAction action = client.getRedirectAction(context, true, false);
            Saml2Credentials credentials;


            try {
                credentials = client.getCredentials(context);

            } catch (Exception e) {
                throw new IllegalStateException(e);
            }
            saml2Profile = client.getUserProfile(credentials, context);

            if (action.getType() == RedirectType.REDIRECT) {
                response.sendRedirect(action.getLocation());
//                return HttpResponses.redirectTo(action.getLocation());

            } else if (action.getType() == RedirectType.SUCCESS) {
                response.sendRedirect(action.getLocation());
            } else {
                throw new IllegalStateException("Received unexpected response type " + action.getType());
            }
        } catch (RequiresHttpAction e) {
            throw new IllegalStateException(e);
        } catch (IOException e) {
            throw new IllegalStateException(e);
        }
    }

  /*  public HttpResponse doFinishLogin(StaplerRequest request, StaplerResponse response) {
        LOG.finer("SamlSecurityRealm.doFinishLogin called");

        Saml2Client client = newClient();
        WebContext context = new J2EContext(request, response);
        Saml2Credentials credentials;
        try {
            credentials = client.getCredentials(context);
        } catch (RequiresHttpAction e) {
            throw new IllegalStateException(e);
        }

        Saml2Profile saml2Profile = client.getUserProfile(credentials, context);

        // retrieve user display name
        String userFullName = null;
        List<?> names = (List<?>) saml2Profile.getAttribute(DEFAULT_DISPLAY_NAME_ATTRIBUTE_NAME);
        if (names != null && !names.isEmpty()) {
            userFullName = (String) names.get(0);
        }

        // prepare list of groups
        List<?> groups = (List<?>) saml2Profile.getAttribute(DEFAULT_GROUPS_ATTRIBUTE_NAME);
        if (groups == null) {
            groups = new ArrayList<String>();
        }

        // build list of authorities
        List<GrantedAuthority> authorities = new ArrayList<GrantedAuthority>();
        authorities.add(AUTHENTICATED_AUTHORITY);
        if (!groups.isEmpty()) {
            for (Object group : groups) {
                SamlGroupAuthority ga = new SamlGroupAuthority((String)group);
                authorities.add(ga);
            }
        }

        // create user data
        SamlUserDetails userDetails = new SamlUserDetails(saml2Profile.getId(), authorities.toArray(new GrantedAuthority[authorities.size()]));
        SamlAuthenticationToken samlAuthToken = new SamlAuthenticationToken(userDetails);

        // initialize security context
        SecurityContextHolder.getContext().setAuthentication(samlAuthToken);
        SecurityListener.fireAuthenticated(userDetails);

        // update user full name if necessary
        if (userFullName != null && !userFullName.isEmpty()) {
            User user = User.current();
            if (userFullName.compareTo(user.getFullName()) != 0) {
                user.setFullName(userFullName);
                try {
                    user.save();
                } catch (IOException e) {
                    // even if it fails, nothing critical
                    LOG.log(Level.WARNING, "Unable to save updated user data", e);
                }
            }
        }

        // redirect back to original page
        String referer = (String) request.getSession().getAttribute(REFERER_ATTRIBUTE);
        String redirectUrl = referer != null ? referer : baseUrl();
        return HttpResponses.redirectTo(redirectUrl);
    }*/

    private Saml2Client newClient() {
        StringBuilder sb = new StringBuilder();
        try {
            BufferedReader br = new BufferedReader(new FileReader(new File("d:\\FederationMetadata.xml")));
            String line;


            while ((line = br.readLine()) != null) {
                sb.append(line.trim());
            }
        } catch (FileNotFoundException e) {
            System.out.println(e);
        } catch (IOException e) {
            System.out.println(e);
        }
        Preconditions.checkNotNull(sb.toString());

        Saml2Client client = new Saml2Client();
        client.setIdpMetadata(sb.toString());
        client.setCallbackUrl("https://localhost:44301/saml_response");
//        client.setDestinationBindingType("urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST");
        client.setDestinationBindingType("urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect");
        client.setMaximumAuthenticationLifetime(DEFAULT_MAXIMUM_AUTHENTICATION_LIFETIME);
        return client;
    }
}
